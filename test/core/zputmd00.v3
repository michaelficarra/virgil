//@execute 0=99
class Addr {}
class List<T>(head: T, tail: List<T>) {}

class DataWriter {
	var data: Range<byte> = Array<byte>.new(11);
	var pos: int;
	var end: int;

	def putr(r: Range<byte>) -> this {
	}
	def send<R>(f: Range<byte> -> R) -> R {
		return f(data[0 ... end]);
	}
}
class MachDataWriter extends DataWriter {
	var refs: List<(Addr, /*posAddr:*/int, /*pos:*/int)>;
	def putmd(w: MachDataWriter) {
		var p = this.pos;
		w.send(putr);
		for (l = w.refs; l != null; l = l.tail) {
			var t = l.head;
			refs = List.new((t.0, t.1 + p, t.2 + p), refs);
		}
		w.refs = null;
	}
}

def main(a: int) -> int {
	var mdw1 = MachDataWriter.new();
	mdw1.refs = List.new((Addr.new(), 11, 22), null);
	mdw1.putmd(MachDataWriter.new());
	return 99;
}
